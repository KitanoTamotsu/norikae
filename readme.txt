電車ルート検索.alfredworkflowのメモ

機能：
入力した出発駅、到着駅、到着時間（省略可）から電車ルートを検索
※複数パラメータを扱うワークフローです

インストール：
　1.alfredworkflowをダウンロード
　2.ファイルをダブルクリックしてワークフローに登録

使い方：
　Alfredへの入力
　キーワード（電車）＋パタメータ（出発駅、到着駅、到着時間）
　
開発メモ：

1.検索結果のURLを解析する

　とりあえずジョルダンの乗換案内で色々試して解析
　
　　&eki1=出発駅（駅の文字は不要、％エンコードなし）
　　&eki2=到着駅（駅の文字は不要、％エンコードなし）
　　&eki3=経由駅（駅の文字は不要、％エンコードなし）
　　&Dym=年月
　　&Ddd=日
　　&Dhh=時
　　&Dmn=分
　　&Cway=0が出発時間、1が到着時間
　　など

　この他にもパラメータが多いのですが、
　Alfredに複雑な入力は似合わないので、出発駅、到着駅、到着時間（省略可）、日付は入れずに当日検索のみ、でいいかな
　たぶんこんなURLを作れば良さそう

　https://www.jorudan.co.jp/norikae/cgi/nori.cgi?&eki1=出発駅&eki2=到着駅&S=検索&Dhh=時間&Dmn=分&Cway=1


2．パラメータを分割する

  Alfredのワークフローユーティリティとしてsplit arg to valsがあります
　駅名（全角）と到着時間（半角）の入力となるので、区切り文字として、全角空白と半角空白を指定したいですね
　と思ったら、複数の区切り文字の設定方法がわかりませんでした
　
　そこでスクリプトで全角空白を半角空白に置き換えてから配列に代入してみました
　arg=`echo $query |sed  's/　/ /g'`
　arr=($arg)
　
　こうするとこの後のコードで各パラメータをarr[0],arr[1],arr[2]として利用できます

　※ちなみにAlfredのsplit arg to valsワークフローでは、配列ではなくsplit1,split2,split3という変数になります
　　splitは接頭語として変更することができます


3．省略可能パラメータが入力されているか確認する


 if [ ${arr[2]} ]; then として、3番目のパラメータがある場合は、到着時間の設定をURLに追加しています
 あとはOpen URLの受け渡してアクセしします
 Httpsから始まる全体のURLを生成していますので、後続のOpen URLのURL欄には{query}があるだけです。


4.そのた
　どなたか、Alfredのワークフローユーティリsplit arg to valsで区切り文字について
　複数指定する方法があれば教えてください


背景：

　今回は複数パラメータに挑戦してみました
　split arg to valsを目論んでいたのですが、敢えなく失敗。スクリプトで対応しました

　路線検索はナビタイム、駅探、ヤフーなどURLが露出しているのでどれでもよかったのですがジョルダンで実装しました
　なおgoogleは埋め込み型のwebアプリで、『〇〇駅から××駅』という入力だけでOKなのでワークフロー要らずでした。。。


